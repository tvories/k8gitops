---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: brandon
  namespace: selfhosted
spec:
  interval: 5m
  chart:
    spec:
      chart: wordpress
      version: 15.2.22
      sourceRef:
        kind: HelmRepository
        name: bitnami-charts
        namespace: flux-system
  values:
    image:
      tag: 6.1.1-debian-11-r15
    wordpressUsername: ${WORDPRESS_BRANDON_USERNAME}
    wordpressPassword: ${WORDPRESS_BRANDON_PASSWORD}
    wordpressEmail: ${WORDPRESS_BRANDON_EMAIL}
    wordpressFirstName: ${WORDPRESS_BRANDON_FIRSTNAME}
    wordpressLastName: ${WORDPRESS_BRANDON_LASTNAME}
    wordpressBlogName: Bloody Cells

    ingress:
      enabled: true
      ingressClassName: nginx-external
      hostname: &host brandon.${SECRET_DOMAIN}
      annotations:
        cert-manager.io/cluster-issuer: letsencrypt-production
      tls: true
      secrets:
        - name: brandon-wordpress.tls

    persistence:
      enabled: true
      existingCLaim: brandon-wordpress-data

    mariadb:
      enabled: true
      auth:
        rootPassword: ${WORDPRESS_BRANDON_MDB_ROOT_PASSWORD}
        password: ${WORDPRESS_BRANDON_MDB_PASSWORD}
      primary:
        persistence:
          enabled: true
          existingClaim: brandon-wordpress-database
