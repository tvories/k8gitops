# # Example of PostgreSQL cluster
# apiVersion: postgresql.cnpg.io/v1
# kind: Cluster
# metadata:
#   name: cnpg-readarr
#   namespace: downloads
# spec:
#   instances: 1

#   # Example of rolling update strategy:
#   # - unsupervised: automated update of the primary once all
#   #                 replicas have been upgraded (default)
#   # - supervised: requires manual supervision to perform
#   #               the switchover of the primary
#   primaryUpdateStrategy: unsupervised

#   # superuserSecret:
#   #   name: superuser-secret

#   bootstrap:
#     initdb:
#       database: readarr
#       owner: ${SECRET_READARR_PGUSER}
#       secret:
#         name: app-secret

#   storage:
#     size: 2Gi
#     storageClass: ceph-block
#   backup:
#     retentionPolicy: "30d"
#     barmanObjectStore:
#       wal:
#         compression: bzip2
#       destinationPath: s3://cnpg/
#       endpointURL: http://minio.database.svc.cluster.local:9000
#       s3Credentials:
#         accessKeyId:
#           name: minio-creds
#           key: ACCESS_KEY_ID
#         secretAccessKey:
#           name: minio-creds
#           key: ACCESS_SECRET_KEY

---
apiVersion: v1
kind: Secret
type: Opaque
metadata:
  name: minio-creds
  namespace: downloads
stringData:
  ACCESS_KEY_ID: ${SECRET_CLUSTER_MINIO_ACCESS_KEY}
  ACCESS_SECRET_KEY: ${SECRET_CLUSTER_MINIO_SECRET_KEY}

---
apiVersion: v1
kind: Secret
type: Opaque
metadata:
  name: app-secret
  namespace: downloads
stringData:
  username: ${SECRET_READARR_PGUSER}
  password: ${SECRET_READARR_PGPASSWORD}

---
apiVersion: postgresql.cnpg.io/v1
kind: ScheduledBackup
metadata:
  name: daily-backup-readarr
  namespace: database
spec:
  schedule: "@daily"
  cluster:
    name: cnpg-readarr

---
apiVersion: postgresql.cnpg.io/v1
kind: Backup
metadata:
  name: backup-readarr
  namespace: downloads
spec:
  cluster:
    name: cnpg-readarr
